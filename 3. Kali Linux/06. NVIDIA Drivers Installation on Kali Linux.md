
# NVIDIA Drivers Installing on Optimus Laptop (Kali Linux)

> An NVIDIA driver is software that acts as a bridge between your operating system and your NVIDIA graphics card (GPU).
---

## Step 1: Check Your System Info

```php
uname -a
```
```php
lspci | grep -E "VGA|3D"
```

> Example Output:

```php
VGA compatible controller: Intel Corporation TigerLake-H GT1 [UHD Graphics]
VGA compatible controller: NVIDIA Corporation GA107M [GeForce RTX 3050 Mobile]
```

---

## Step 2: Disable the Nouveau Driver (Open Source NVIDIA)

```php
echo -e "blacklist nouveau\noptions nouveau modeset=0\nalias nouveau off" | sudo tee /etc/modprobe.d/blacklist-nouveau.conf
```
```php
sudo update-initramfs -u
```
```php
sudo reboot
```

> After reboot:

```php
lsmod | grep -i nouveau
```
> If it returns **nothing**, Nouveau is disabled successfully.

---

##  Step 3: Install NVIDIA Driver

```php
sudo apt install nvidia-driver nvidia-xconfig
```
> If it gives errors:

```php
sudo apt install nvidia-xconfig
```

---

## Step 4: Find NVIDIA BusID

```php
nvidia-xconfig --query-gpu-info | grep 'BusID' | cut -d ' ' -f6-
```
> Example BusID Output:

```php
PCI:1:0:0
```

---

## Step 5: Configure Dual GPU (Fix Black Screen or Dual Monitor Issues)

> Create/Edit the Xorg configuration:

```php
sudo vim /etc/X11/xorg.conf
```

> Paste the following config (replace **BusID** with your actual one if different):

```php
Section "ServerLayout"
    Identifier "layout"
    Screen 0 "nvidia"
    Inactive "intel"
EndSection

Section "Device"
    Identifier "nvidia"
    Driver "nvidia"
    BusID "PCI:1:0:0"
EndSection

Section "Screen"
    Identifier "nvidia"
    Device "nvidia"
    Option "AllowEmptyInitialConfiguration"
EndSection

Section "Device"
    Identifier "intel"
    Driver "modesetting"
EndSection

Section "Screen"
    Identifier "intel"
    Device "intel"
EndSection
```

---

## Step 6: Create Optimus Autostart Script (Fix for GDM)

```php
sudo vim /usr/share/gdm/greeter/autostart/optimus.desktop
```

> Paste this:

```php
[Desktop Entry]
Type=Application
Name=Optimus
Exec=sh -c "xrandr --setprovideroutputsource modesetting NVIDIA-0; xrandr --auto"
NoDisplay=true
X-GNOME-Autostart-Phase=DisplayServer
```

> Then:

```php
sudo cp -v /usr/share/gdm/greeter/autostart/optimus.desktop /etc/xdg/autostart/optimus.desktop
```

---

## Step 7: Final Driver Reboot

> If required:

```php
[ -f /var/run/reboot-required ] && sudo reboot -f
```

> Or just:

```php
sudo reboot
```

---

# CUDA Toolkit Setup (For GPU Acceleration)

> Official Site: [CUDA Downloads](https://developer.nvidia.com/cuda-downloads)

---

##  Step 1: Add CUDA Repository Keyring

```php
wget https://developer.download.nvidia.com/compute/cuda/repos/debian12/x86_64/cuda-keyring_1.1-1_all.deb
```
```php
sudo apt install ./cuda-keyring_1.1-1_all.deb
```

---

## Step 2: (Optional) Comment Out Kali Default Repos

```php
sudo vim /etc/apt/sources.list
```

> Comment out:

```php
# deb https://http.kali.org/kali kali-rolling main contrib non-free non-free-firmware
```

> ðŸ”— Ref: [Kali Source Guide](https://www.kali.org/docs/general-use/kali-linux-sources-list-repositories/)

---

## Step 3: Install CUDA Toolkit & DKMS

```php
sudo apt update
```
```php
sudo apt install cuda-toolkit-12-9
```
```php
sudo apt install cuda-drivers nvidia-kernel-dkms
```
```php
sudo reboot
```

---

## Final Verification

> Check if NVIDIA driver is working:

```php
nvidia-smi
```

> Check kernel modules:

```php
lsmod | grep -i nvidia
```

---

## Extra: Test GPU Acceleration

###  Hashcat

```php
hashcat -I
```
```php
hashcat -b  # Benchmark
```
---


## NVIDIA DRIVER CLEANUP COMMANDS

> Cautionâš  :

> In case of the mis-configuration or any error, if you want to remove the NVIDIA drivers just follow the commands mentioned below and the drivers will be removed:

```php
apt-get remove --purge nvidia*
rm -rf /etc/X11/xorg.conf
dpkg --configure -a
apt autoremove
```

---
> After the successful installation of NVIDIA drivers and everything,

> DON't run the following commands as it can result in the deletion if the drivers.

```php
apt autoremove
apt autoclean
```

---



# Installing FFmpeg with NVENC Support (Kali Linux)

> FFmpeg with NVENC allows hardware-accelerated video encoding using supported NVIDIA GPUs. It's ideal for faster video processing, screen recording, and streaming.
---

## Step 1: Install FFmpeg

```php
sudo apt update
sudo apt install ffmpeg
```

---

## Step 2: Check NVENC Encoder Support

```php
ffmpeg -encoders 2>/dev/null | grep nvenc
```

> If output shows encoders like `h264_nvenc` or `hevc_nvenc`, NVENC is enabled.

---

## Step 3: Benchmark GPU with Hashcat

> Check CUDA acceleration and GPU benchmark:

```php
hashcat -I
hashcat -b
```

---

# Installing NVIDIA Video Codec SDK (For NVENC/NVDEC Support)

> The NVIDIA Video Codec SDK allows low-level access to hardware-accelerated encoding (NVENC) and decoding (NVDEC), and is useful for compiling or extending media tools like FFmpeg.

---

## Step 1: Download the SDK

> Go to the official SDK page:
> ðŸ‘‰ [https://developer.nvidia.com/nvidia-video-codec-sdk](https://developer.nvidia.com/nvidia-video-codec-sdk)

>  You need an NVIDIA Developer account to download.

### Download file:

```php
Video_Codec_SDK_13.0.19.zip
```

---

## Step 2: Extract and Move to Standard Path

```php
unzip Video_Codec_SDK_13.0.19.zip
```
```php
sudo mv -v Video_Codec_SDK_13.0.19 /opt/
```

---

## Step 3: Verify CUDA Headers

> Make sure CUDA Toolkit is installed and include path exists:

```php
ls /usr/local/cuda/include
```

> If not found, install CUDA Toolkit first (scroll down to CUDA section below).

---

## Step 4: Copy SDK Headers to CUDA Include Path

```php
cd /opt/Video_Codec_SDK_13.0.19/Interface
```
```php
sudo cp -v *.h /usr/local/cuda/include/
```

> âœ… This enables FFmpeg or other tools to compile with NVENC/NVDEC support.

---

##  Final Verifications

> Check NVENC support:

```php
ffmpeg -hide_banner -hwaccels
```

> Check NVIDIA driver + GPU health:

```php
nvidia-smi
```

---
ðŸ“– Reference: Notes inspired by guidance from Mr. Sachin Verma ([Armour Infosec](https://www.armourinfosec.com/)) and enriched with further improvements and updates.

