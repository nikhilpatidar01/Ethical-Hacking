
# Nmap (Network Mapper)

**Nmap (Network Mapper)** is a powerful open-source tool for network discovery and security auditing.

### Primary Uses:

* **Discovery**: Identifies active devices and systems on a network
* **Port Scanning**: Detects open ports and associated network services
* **Service & Version Detection**: Determines the software and versions running on open ports, aiding in inventory and vulnerability checks
* **OS Detection**: Identifies the operating system and version used by target devices
* **Scanning**: Finds known security vulnerabilities by probing network services and analyzing responses
* **Firewall/IDS Evasion**: Includes techniques to bypass security controls like firewalls and intrusion detection systems, such as using decoys, fragmenting packets, or manipulating packet headers

These features make Nmap invaluable for administrators, security professionals, and auditors seeking to secure and understand networks.


## What is Nmap?

Nmap is an open-source utility for network discovery and security auditing. It maps networks by discovering hosts and services.

### How it works:

Sends specially crafted packets to target hosts and analyzes responses to identify hosts, services, operating systems, and firewall types.

### Compatibility:

Runs on Linux, Windows, macOS, BSD, Solaris, etc. with both command-line and GUI (Zenmap) interfaces.

## Key Features

* Supports advanced techniques including TCP, UDP, ICMP, and IP protocol scans
* Handles large network scans and hosts efficiently
* Includes Nmap Scripting Engine (NSE) for automated vulnerability detection
* Widely used, awarded, and featured in films and publications

---

# Nmap Interaction with OSI Model Layers

## 1. Network Layer (Layer 3)

* Sends raw IP packets for host discovery, ping sweeps, and protocol scans
* Manipulates IP packets: fragmentation, TTL (`--ttl`), source IP spoofing
* Supports firewall/IDS evasion using decoys, fragmentation, and custom routing

### Example Commands:

```
nmap -f 192.168.1.1                # Fragmented packets  
nmap -sO 192.168.1.1               # Protocol scan  
nmap -S 192.168.1.100 192.168.1.1  # IP spoofing  
```

## 2. Transport Layer (Layer 4)

* Port scanning (TCP & UDP) with various techniques
* TCP SYN scan (`-sS`), Connect scan (`-sT`), FIN scan (`-sF`), Null scan (`-sN`), Xmas scan (`-sX`)
* UDP scan (`-sU`)
* Service and version detection (`-sV`)
* Firewall/IDS evasion: scan speed control (`--scan-delay`, `--max-retries`)

### Sample Commands:

```
nmap -sS 192.168.1.1  
nmap -sU -p 53 192.168.1.1  
nmap -sV 192.168.1.1  
```
---

<img src="https://raw.githubusercontent.com/nikhilpatidar01/Ethical-Hacking/Master/4.%20Network%20Reconnaissance%20Scanning/Image/NMAP.png" alt="Nmap Image">

---
# Network Network Layer (Layer 3 – OSI Model)

The Network Layer (Layer 3) manages routing and movement of packets across networks. Nmap utilizes this layer for advanced discovery and scanning.

### IP Packet Handling

* **Raw IP Packets**: Used for scanning and discovering live systems
* **ICMP Echo Requests**: Used for ping sweeps
* **Fragmented Packets**: Used to evade firewalls and IDS

### Routing & Reachability

* **Route Selection**: Determines optimal paths
* **Custom Gateways**: Specify gateway or source IP using `--source-ip` or `--route-dst`

### Custom IP Packet Manipulation

* **Raw Packet Crafting**: Custom IP packets for different scan types (`-sS`, `-sA`)
* **TTL**: Adjusts time-to-live (`--ttl`) for hop limits or advanced probing
* **Fragmentation**: `-f` option sends fragmented packets

### Firewall & IDS Evasion Techniques

* **Decoy Scanning** (`-D`): Sends spoofed packets to mask real source
* **Custom MTU** (`--mtu`): Sets maximum transmission unit for evasion

### IP Protocol Scan (`-sO`)

* **Protocol Discovery**: Lists all network-layer protocols available by sending protocol packets

### Summary:

Nmap’s Network Layer capabilities allow it to probe, enumerate, and bypass security, providing detailed visibility into topology and host availability using multiple stealth methods.


# Transport Layer in Nmap (Layer 4 – OSI Model)

The Transport Layer ensures reliable end-to-end communication. Nmap leverages this layer for scanning and analyzing network services.

### How Nmap Uses the Transport Layer

#### Port Scanning (TCP & UDP)

* **TCP SYN Scan (`-sS`)**: Half-open scan; sends SYN packets but doesn't complete handshake
* **Connect Scan (`-sT`)**: Completes full three-way handshake
* **Null Scan (`-sN`)**: Sends TCP packets with no flags for stealth

#### UDP Scans (`-sU`)

* Probes services like DNS, SNMP, TFTP
* Slower due to lack of guaranteed delivery and possible retransmissions

#### Service Version Detection (`-sV`)

* After identifying open ports, interrogates them to determine the exact software and version

#### TCP Flags & Evasion

* **FIN Scan (`-sF`)**: Sends TCP packets with FIN flag to detect closed ports
* **Xmas, ACK, Null Scans**: Use different flag combinations to bypass filters

#### Determining Firewall Rules

* **Scan Timing**: `--scan-delay`, `--max-retries` adjust scan speed and packet intervals to avoid IDS/IPS triggering

### Summary:

Nmap’s transport layer functionality enables detailed port and service scanning, OS fingerprinting, and stealthy probing, making it essential for security auditing.

---

## Transport Layer Scan Types with Examples

| Scan Type              | Description                           | Command Example            |
| ---------------------- | ------------------------------------- | -------------------------- |
| TCP SYN Scan           | Half-open stealth scan                | nmap -sS 192.168.1.1       |
| TCP Connect Scan       | Full TCP handshake                    | nmap -sT 192.168.1.1       |
| UDP Scan               | Scans UDP ports (DNS, SNMP, etc.)     | nmap -sU -p 53 192.168.1.1 |
| Service Version Detect | Identifies service versions           | nmap -sV 192.168.1.1       |
| FIN Scan               | Sends FIN flag to detect closed ports | nmap -sF 192.168.1.1       |
| Xmas Scan              | Sends FIN, PSH, URG flags             | nmap -sX 192.168.1.1       |

This summary provides frequently used Nmap commands for scanning different protocols and detecting services. You can practice on your network or the authorized test server: `scanme.nmap.org`.

---

## Nmap Installation Commands

### Debian/Ubuntu-Based (APT)

```
sudo apt install nmap
```

### Red Hat/CentOS/Fedora (YUM)

```
sudo yum install nmap
```

### Unix Platforms (Solaris, FreeBSD, NetBSD, OpenBSD) - From Source:

- [Download (nmap-7.97.tar.bz2)](https://nmap.org/dist/nmap-7.97.tar.bz2)

```php
bzip2 -dc nmap-*.tar.bz2 | tar xvf -  
cd nmap-*  
./configure  
make  
sudo make install  
```

> Download the latest `nmap-*.tar.bz2` from the official Nmap website. Use `sudo` for commands needing administrative rights.

### Notes:

* APT and YUM automatically handle dependencies
* Building from source is recommended if precompiled binaries are unavailable or the latest version is needed

---

## Common Nmap Commands and Usage Examples

### Help and Usage Information

```
nmap -h  
```
> Or
```
nmap --help  
```

### Check Nmap Version

```
nmap -V
```
> Or
```
nmap --version  
```

### Basic Scanning

- Scan specific IP
```php
nmap 192.168.1.35
```
- Scan hostname/domain
```php                  
nmap target.com
```
- Verbose scan
```php                      
nmap -v 192.168.1.35                 
```
- Scan authorized test server  
```php
nmap -v scanme.nmap.org
```

> Note: `scanme.nmap.org` is provided by the Nmap project for public testing.

---

